/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/barea.js@1.2.4/barea.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";export class BareaApp{#e=null;#t;#a;#r=0;#n=0;#i;#s=new WeakMap;#o=new Map;#l=[];#d=[];#c;#p={};#u=!1;#h=null;#m={};#y=!1;#E=null;#f=null;constructor(e){e&&(this.#y=e),this.#f=this.#D(),this.#E=this.#P(this.#I)}async mount(e,t){if(!("fetch"in window&&"Promise"in window&&"Symbol"in window&&"Map"in window))return void console.error("Your browser and js engine is too old to use barea.js");if(this.#u)return;if(this.#e=t,!t)return void console.error("Illegal use of mount, please pass a content object with data and methods");if(!t.data)return void console.error("Illegal use of mount, please pass a content object with data and methods");if(!e)return void console.error("Illegal use of mount, please pass an element or an element identifier");if(this.#t="object"==typeof e?e:document.getElementById(e),this.#a=this.#t.cloneNode(!0),t.methods&&(this.#p=t.methods,Object.assign(this,this.#p),Object.keys(t.methods).forEach((e=>{"function"==typeof this[e]&&(this[e]=this[e].bind(this))}))),t.computed&&(Object.keys(t.computed).forEach((e=>{"function"==typeof t.computed[e]&&(this.#m[e]=this.#_(t.computed[e],e),this.#l.push(e))})),Object.keys(this.#m).forEach((e=>{Object.defineProperty(this,e,{get:()=>this.#m[e].value,enumerable:!0,configurable:!0})}))),t.mounted){this.#h=t.mounted;const e=this.#h.apply(this,[t.data]);e instanceof Promise&&await e}this.#c=t.data,this.#i=t.data;const a=this.#T(((e,t,a,r,n="")=>{let i=BareaHelper.getDebugLog(1);if(i.active&&console.log(i.name,e,t,a,r,n),Array.isArray(t)&&BareaHelper.ARRAY_FUNCTIONS.includes(n)){let r=BareaHelper.getLastBareaObjectPath(e);a=BareaHelper.getLastBareaKeyName(e),(t=this.getProxifiedPathData(r))||console.error("could not find array on path: "+e)}this.#E.notify(e,t,a,r,n)}),this.#c);return this.#i=a,this.#u=!0,this.#g(),this.#v(),this.#R(),this.#i}refresh(){if(!this.#u)return;if(!this.#t)return void console.error("The app element is missing in barea.js");this.#E.clear(),Object.keys(this.#m).forEach((e=>{this.#m[e].clearDependentDirectives()})),this.#o.clear(),this.#e.computed&&(this.#m={},Object.keys(this.#e.computed).forEach((e=>{"function"==typeof this.#e.computed[e]&&(this.#m[e]=this.#_(this.#e.computed[e],e),this.#l.push(e))})),Object.keys(this.#m).forEach((e=>{Object.defineProperty(this,e,{get:()=>this.#m[e].value,enumerable:!0,configurable:!0})})));const e=this.#a.cloneNode(!0);this.#t.replaceWith(e),this.#t=e,this.#g(),this.#v(),this.#R()}getData(){return this.#u?this.#i:(console.warn("barea.js is not mounted. Call mount on the instance before using this method."),null)}getProxifiedPathData(e,t,a){if(!e&&t)return t;if(!e)return this.#i;const r=e.match(/[^.[\]]+/g);if(!r&&t)return t;if(!r)return this.#i;let n=t||this.#i;for(let e=0;e<r.length;e++)if(0!==e||!("root"===r[e].toLowerCase()||a&&r[e].toLowerCase()===a.toLowerCase())){if(!n)return;n=n[r[e]]}return n}getPathData(e){if(!e)return this.#c;const t=e.match(/[^.[\]]+/g);if(!t)return this.#c;let a=this.#c;for(let e=0;e<t.length;e++)if(0!==e||"root"!==t[e].toLowerCase()){if(!a)return;a=a[t[e]]}return a}#T(e,t,a="root"){return new Proxy(t,{get:(t,r,n)=>{let i=Reflect.get(t,r,n);if(r===Symbol.iterator)return function*(){let r=0;for(let n of t){let t=`${a}[${r++}]`;if("object"==typeof n&&null!==n)if(this.#s.has(n))yield this.#s.get(n);else{const a=this.#T(e,n,t);this.#s.set(n,a),yield a}else yield n}}.bind(this);const s=Array.isArray(t)?`${a}[${r}]`:`${a}.${r}`;if("function"!=typeof i&&this.#f.track(s,null),"object"==typeof i&&null!==i){if(Array.isArray(i)||!this.#y||i.hasOwnProperty("baId")||(i.baId=++this.#r),this.#s.has(i))return this.#s.get(i);const t=this.#T(e,i,s);return this.#s.set(i,t),t}return"function"==typeof i&&BareaHelper.ARRAY_FUNCTIONS.includes(i.name)?(this.#n++,(...r)=>{let s=[];r.forEach((t=>{let a=null;"object"==typeof t?(a=this.#T(e,t),this.#s.has(t)||this.#s.set(t,a)):a=t,s.push(a)}));const o=i.apply(t,r);return this.#f.notify(a,i.name),e(a,n,"",s,i.name),o}):i},set:(t,r,n,i)=>{const s=Array.isArray(t)?`${a}[${r}]`:`${a}.${r}`;return"function"==typeof n&&!BareaHelper.ARRAY_FUNCTIONS.includes(n.name)||(t[r]===n||(t[r]=n,"function"==typeof n&&BareaHelper.ARRAY_FUNCTIONS.includes(n.name)?this.#f.notify(s,n.name):this.#f.notify(s,null),e(s,i,r,i[r])),!0)}})}#R(){this.#E.getTemplateDependencies().forEach((e=>{BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(e.directivename)&&e.element.remove()}))}#v(){this.#d.forEach((e=>{if(e.inputtype===BareaHelper.UI_INPUT_SELECT){this.#E.track("value",e),this.#b(e);let t=e.directivename===BareaHelper.DIR_BIND?"change":"blur";const a=function(t){if(e.hashandler)return void this.#B(BareaHelper.VERB_SET_DATA,e);let a=BareaHelper.getDebugLog(3);a.active&&console.log(a.name,"select ","key: "+valuekey,"value: "+el.value),e.data[e.key]=e.element.value}.bind(this);e.element.removeEventListener(t,a),e.element.addEventListener(t,a)}})),this.#d=[]}#g(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1}){let a=this.#H(),r=Array.from(e.querySelectorAll("*"));r.unshift(e),r.forEach((r=>{const n=Array.from(r.attributes).filter((e=>e.name.startsWith("ba-"))).map((e=>({name:e.name,value:e.value})));if(!n)return;if(!n.length>0)return;if(a.includes(r))return;let i=!1;n.forEach((e=>{BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(e.name)&&(i=!0)})),n.forEach((a=>{a.value&&(!BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(a.name)&&i||(this.#n++,BareaHelper.DIR_GROUP_BIND_TO_PATH.includes(a.name)?this.#N(e,t,r,a.name,a.value):BareaHelper.DIR_GROUP_COMPUTED.includes(a.name)?this.#C(e,t,r,a.name,a.value):BareaHelper.DIR_GROUP_TRACK_AND_FORGET.includes(a.name)?this.#O(e,t,r,a.name,a.value):BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(a.name)&&this.#A(e,t,r,a.name,a.value)))}))})),this.#w(e,t);let n=BareaHelper.getDebugLog(4);n.active&&(console.log(n.name),this.#E.getAllDependencies().forEach(((e,t)=>{console.log(t,e)}))),n=BareaHelper.getDebugLog(5),n.active&&(console.log(n.name),this.#f.getAllDependencies().forEach(((e,t)=>{console.log(t,e)})))}#N(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1},a,r,n){const i=this.#k(n,r,t.renderedvarname);if(i===BareaHelper.EXPR_TYPE_INVALID)return void console.error(`The ${r} directive with value: (${n}) is invalid.`);let s="",o=-1;BareaHelper.DIR_GROUP_UI_DUPLEX.includes(r)&&("select"===a.tagName.toLowerCase()?o=BareaHelper.UI_INPUT_SELECT:(s=a.getAttribute("type"),s?(o=1,"text"===s.toLowerCase()&&(o=BareaHelper.UI_INPUT_TEXT),"checkbox"===s.toLowerCase()&&(o=BareaHelper.UI_INPUT_CHECKBOX),"radio"===s.toLowerCase()&&(o=BareaHelper.UI_INPUT_RADIO)):o=BareaHelper.UI_INPUT_CUSTOM));let l=this.#S(t,a,r,n,null,"",o);if(l.expressiontype=i,!t.rendereddata||n.startsWith(BareaHelper.ROOT_OBJECT)){let e=BareaHelper.getLastBareaObjectPath(n);l.data=this.getProxifiedPathData(e),l.key=BareaHelper.getLastBareaKeyName(n)}else l.data=t.rendereddata,l.key=BareaHelper.getLastBareaKeyName(n);if(!l.data||!l.key)return void console.error(`Could not track directive ${r} (${n}) could not match data at the given path`);let d=a.getAttribute(BareaHelper.DIR_BIND_HANDLER);if(d){if(this.#k(d,BareaHelper.DIR_BIND_HANDLER)===BareaHelper.EXPR_TYPE_INVALID)return void console.error(`The ${BareaHelper.DIR_BIND_HANDLER} directive has an invalid value (${d}), should be funcname(), or funcname(args..).`);l.hashandler=!0,l.handlername=d}if(l.inputtype===BareaHelper.UI_INPUT_SELECT?this.#d.push(l):this.#E.track("value",l),BareaHelper.DIR_GROUP_UI_DUPLEX.includes(l.directivename)){l.hashandler&&this.#B(BareaHelper.VERB_SET_UI,l),l.inputtype===BareaHelper.UI_INPUT_TEXT?this.#x(l):l.inputtype===BareaHelper.UI_INPUT_CHECKBOX?this.#L(l):l.inputtype===BareaHelper.UI_INPUT_RADIO&&this.#U(l);let e=l.directivename===BareaHelper.DIR_BIND?"input":"blur";const t=function(e){if(l.hashandler)return void this.#B(BareaHelper.VERB_SET_DATA,l);let t=BareaHelper.getDebugLog(3);l.inputtype===BareaHelper.UI_INPUT_CHECKBOX?(t.active&&console.log(t.name,"type: "+a.type,"key: "+valuekey,"input value: "+a.checked),l.data[l.key]=a.checked):l.inputtype===BareaHelper.UI_INPUT_RADIO?(t.active&&console.log(t.name,"type: "+a.type,"key: "+valuekey,"input value: "+a.value),a.checked&&(l.data[l.key]=a.value)):(t.active&&console.log(t.name,"type: "+a.type,"key: "+valuekey,"input value: "+a.value),l.data[l.key]=a.value)}.bind(this);a.removeEventListener(e,t),a.addEventListener(e,t)}else if(l.directivename===BareaHelper.DIR_CLASS){let e=a.getAttribute("classNames");l.orgvalue=e,this.#$(l)}else l.directivename===BareaHelper.DIR_HREF?this.#X(l):l.directivename===BareaHelper.DIR_IMAGE_SRC?this.#j(l):l.directivename===BareaHelper.DIR_OPTION_ID?this.#M(l):l.directivename===BareaHelper.DIR_OPTION_TEXT&&this.#F(l)}#C(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1},a,r,n){const i=this.#k(n,r,t.renderedvarname);if(i===BareaHelper.EXPR_TYPE_INVALID)return void console.error(`The ${r} directive has an invalid value (${n}).`);const s=this.#V(t,a,r,n);s.expressiontype=i,t.rendereddata?s.data=t.rendereddata:s.data=this.#i,s.key="";let o=n.trim();o.includes("?")&&(o=o.split("?")[0]);let l=!1,d=this.#o.get(n);if(d&&!t.rendereddata||(l=!0,d=t.template?`${BareaHelper.META_DYN_TEMPLATE_FUNC_PREFIX}${this.#n}`:`${BareaHelper.META_DYN_FUNC_PREFIX}${this.#n}`,this.#o.set(n,d)),r===BareaHelper.DIR_IF&&(s.elementnextsibling=a.nextSibling,s.parentelement=a.parentElement),i===BareaHelper.EXPR_TYPE_COMPUTED)s.handlername=o,this.#m[s.handlername].addDependentDirective(s),this.#Y(s);else if(i===BareaHelper.EXPR_TYPE_ROOT_EXPR){const e=this.#i,t=function(){return o=o.replaceAll("root.","contextdata."),function(e,t){try{return new Function("contextdata",`return ${e};`)(t)}catch(t){return console.error(`Error evaluating expression ${e} on ${a.localName} with attribute ${r}`),!1}}(o,e)};l&&(this.#m[d]=this.#_(t,d),this.#l.push(d)),s.handlername=d,s.iscomputed=!0,this.#m[s.handlername].addDependentDirective(s),this.#Y(s)}else if(i===BareaHelper.EXPR_TYPE_OBJREF_EXPR){const e=function(){return o=o.replaceAll(t.renderedvarname+".","contextdata."),function(e,t){try{return new Function("contextdata",`return ${e};`)(t)}catch(t){return console.error(`Error evaluating expression ${e} on ${a.localName} with attribute ${r}`),!1}}(o,s.data)};if(!t.renderedvarname)return void console.error(`Invalid expression: ${o} to use as a dynamicly created function in a template.`);l&&(this.#m[d]=this.#_(e,d),this.#l.push(d)),s.handlername=d,s.iscomputed=!0,this.#m[s.handlername].addDependentDirective(s),this.#Y(s)}else if(i===BareaHelper.EXPR_TYPE_MIX_EXPR){const e=s.data,n=this.#i,i=function(){return o=o.replaceAll("root.","rootdata."),o=o.replaceAll(t.renderedvarname+".","subdata."),function(e,t,n){try{return new Function("subdata","rootdata",`return ${e};`)(t,n)}catch(t){return console.error(`Error evaluating mixed expression ${e} on ${a.localName} with attribute ${r}`),!1}}(o,e,n)};if(!t.renderedvarname)return void console.error(`Invalid expression: ${o} to use as a dynamicly created function in a template.`);l&&(this.#m[d]=this.#_(i,d),this.#l.push(d)),s.handlername=d,s.iscomputed=!0,this.#m[s.handlername].addDependentDirective(s),this.#Y(s)}}#O(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1},a,r,n){const i=this.#k(n,r);if(i!==BareaHelper.EXPR_TYPE_INVALID){if(i===BareaHelper.EXPR_TYPE_HANDLER){const e=function(e){e.stopPropagation();let r=this.#i,i=a.getAttribute(BareaHelper.META_PATH);i?r=this.getProxifiedPathData(i):t.rendereddata&&(r=t.rendereddata);let s=[e,a,r],o=BareaHelper.parseBareaFunctionCall(n);s.push(...o.params),this.#p[o.functionName]?this.#p[o.functionName].apply(this,s):console.warn(`Handler function '${o.functionName}' not found.`)}.bind(this);a.dataset.listenerAdded||(a.removeEventListener("click",e),a.addEventListener("click",e),a.dataset.listenerAdded="true")}}else console.error(`Then ${r} directive has an invalid value (${n}).`)}#A(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1},a,r,n){const i=this.#k(n,r);if(i===BareaHelper.EXPR_TYPE_INVALID)return void console.error(`Then ${r} directive has an invalid value (${n}).`);let[s,o]=n.split(" in ").map((e=>e.trim()));if(!s)return void console.error(`No variable name was found in the ${r} expression`);if(!o)return void console.error(`No path or computed function was found in the ${r} expression`);if(null!=t.rendereddata)return void console.error("trackMarkUpGeneration was called withn a trackcontext which is not allowed.");const l=this.#G(t,a,r,n,null,"",a.parentElement,a.innerHTML,a.localName);if(l.elementnextsibling=a.nextSibling,l.elementclone=a.cloneNode(!0),l.expressiontype=i,i!==BareaHelper.EXPR_TYPE_COMPUTED){let e=BareaHelper.getLastBareaObjectPath(o);if(l.data=this.getProxifiedPathData(e),l.key=BareaHelper.getLastBareaKeyName(o),!Array.isArray(l.data[l.key]))return void console.error(`could not find array for ${o} in  ${r} directive`);this.#E.track("value",l)}else this.#m[o].addDependentDirective(l),this.#E.track("computed",l);this.#J(l,BareaHelper.ROOT_OBJECT,l.data[l.key])}#w(e=this.#t,t={template:null,rendereddata:null,renderedindex:-1,renderedvarname:"",renderedobjid:-1}){let a=[];if(this.#q(e).forEach((e=>{let r=[],n=e.textNode;e.expressions.forEach((e=>{let a=e.replaceAll("{","").replaceAll("}","").trim();const i=this.#k(a,BareaHelper.DIR_INTERPOLATION,t.renderedvarname);if(i===BareaHelper.EXPR_TYPE_INVALID)return void console.error(`The ${DIR_INTERPOLATION} directive has an invalid expression (${a}).`);let s=this.#K(t,BareaHelper.DIR_INTERPOLATION,a,null,"",n,e,n.nodeValue);if(s.expressiontype=i,i===BareaHelper.EXPR_TYPE_COMPUTED)s.isrendered=!1,s.iscomputed=!0,r.push(s);else if([BareaHelper.EXPR_TYPE_ROOT_PATH,BareaHelper.EXPR_TYPE_OBJREF,BareaHelper.EXPR_TYPE_OBJREF_PATH].includes(i)){s.isobjectexpression=!1;let e=this.getProxifiedPathData(a,t.rendereddata,t.renderedvarname);if("object"!=typeof e){s.key=BareaHelper.getLastBareaKeyName(a);let e=BareaHelper.getLastBareaObjectPath(a);s.data=this.getProxifiedPathData(e,t.rendereddata,t.renderedvarname)}else s.isobjectexpression=!0,s.data=e;s.isrendered=!1,s.iscomputed=!1,r.push(s)}else BareaHelper.INTERPOL_INDEX===i&&t.rendereddata&&(s.isrendered=!0,s.iscomputed=!1,s.data=t.rendereddata,r.push(s),t.template&&(t.template.usesReRenderedInterpolation=!0))})),a.push(r)})),a.length>0){let e=!1;a.forEach((t=>{e||t.forEach((t=>{t.isobjectexpression&&(e=!0)}))})),a.forEach((t=>{let a=t[0];a.nodeexpressions=t,a.nodeexpressions.forEach((a=>{a.nodeexpressions=t,a.iscomputed&&this.#m[a.directivevalue]?this.#m[a.directivevalue].addDependentDirective(a):e?this.#E.track("global",a):this.#E.track("value",a)})),this.#W(a)}))}}#q(e=this.#t){let t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>e.nodeValue.includes("{{")&&e.nodeValue.includes("}}")?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),a=[];for(;t.nextNode();){let e={textNode:t.currentNode,expressions:[]};e.expressions=this.#z(e.textNode.nodeValue),a.push(e)}return a}#H(e=this.#t){if(e!==this.#t)return;let t=[],a=[];function r(e,a){t.push(e);for(let t=0;t<e.children.length;t++)r(e.children[t])}return e.querySelectorAll(`[${BareaHelper.DIR_FOREACH}]`).forEach((e=>{let n=!0;t=[],Array.from(e.children).forEach((e=>r(e)));let i=e.getAttribute(BareaHelper.DIR_FOREACH),[s,o]=i.split(" in ").map((e=>e.trim()));s||(n=!1,console.error(`No variable name was found in the ${BareaHelper.DIR_FOREACH} expression: ${i}`),n=!1),o||(n=!1,console.error(`No path or computed function was found in the ${BareaHelper.DIR_FOREACH} expression: ${i}`),n=!1),t.forEach((e=>{BareaHelper.DIR_GROUP_BIND_TO_PATH.forEach((t=>{if(e.hasAttribute(t)){let a=e.getAttribute(t);a.includes(BareaHelper.ROOT_OBJECT)||a.includes(s)||(n=!1,console.error(`The ${t} expression ${a} used in an element under ${BareaHelper.DIR_FOREACH} does not match the ${BareaHelper.DIR_FOREACH} expression, data should be reference by '${s}'. or '${BareaHelper.ROOT_OBJECT}'.`),n=!1)}}))})),n?a.push(...t):e.parentElement.innerHTML=""})),a}#V(e,t,a,r){return{id:this.#n++,renderedobjid:e.renderedobjid,renderedvarname:e.renderedvarname,template:e.template,directivename:a,directivevalue:r,element:t,data:null,key:"",hashandler:!1,handlername:"",inputtype:-1,iscomputed:!0}}#S(e,t,a,r,n,i,s){return{id:this.#n++,renderedobjid:e.renderedobjid,renderedvarname:e.renderedvarname,template:e.template,directivename:a,directivevalue:r,element:t,data:n,key:i,hashandler:!1,handlername:"",inputtype:s,iscomputed:!1}}#G(e,t,a,r,n,i,s,o,l){return{id:this.#n++,renderedobjid:e.renderedobjid,renderedvarname:e.renderedvarname,template:e.template,directivename:a,directivevalue:r,element:t,data:n,key:i,hashandler:!1,handlername:"",inputtype:-1,iscomputed:!1,parentelement:s,templatemarkup:o,templatetagname:l,usesReRenderedInterpolation:!1}}#K(e,t,a,r,n,i,s,o){return{id:this.#n++,renderedobjid:e.renderedobjid,renderedvarname:e.renderedvarname,template:e.template,directivename:t,directivevalue:a,element:null,data:r,key:n,hashandler:!1,handlername:"",inputtype:-1,iscomputed:!1,isrendered:!1,interpolatednode:i,expression:s,nodetemplate:o,nodeexpressions:[],renderedindex:e.renderedindex}}#I=(e,t,a,r,n,i)=>{n.forEach((e=>{if(BareaHelper.DIR_GROUP_BIND_TO_PATH.includes(e.directivename)){if(e.hashandler)return void this.#B(BareaHelper.VERB_SET_UI,e);BareaHelper.DIR_GROUP_UI_DUPLEX.includes(e.directivename)?e.inputtype===BareaHelper.UI_INPUT_TEXT?this.#x(e):e.inputtype===BareaHelper.UI_INPUT_CHECKBOX?this.#L(e):e.inputtype===BareaHelper.UI_INPUT_RADIO?this.#U(e):e.inputtype===BareaHelper.UI_INPUT_SELECT&&this.#b(e):e.directivename===BareaHelper.DIR_CLASS?this.#$(e):e.directivename===BareaHelper.DIR_HREF?this.#X(e):e.directivename===BareaHelper.DIR_IMAGE_SRC?this.#j(e):e.directivename===BareaHelper.DIR_OPTION_ID?this.#M(e):e.directivename===BareaHelper.DIR_OPTION_TEXT&&this.#F(e)}else e.directivename===BareaHelper.DIR_INTERPOLATION?this.#W(e):BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(e.directivename)?i&&BareaHelper.ARRAY_FUNCTIONS.includes(i)?this.#J(e,r,null,i,a):this.#J(e,r,a,"",null):BareaHelper.DIR_GROUP_COMPUTED.includes(e.directivename)&&this.#Y(e)}))};#Y(e){let t=e.handlername,a=!1;if(this.#m[t]?a=this.#m[t].value:console.warn(`Computed boolean function '${t}' not found.`),e.directivename===BareaHelper.DIR_HIDE)e.element.style.display=a?"none":"";else if(e.directivename===BareaHelper.DIR_SHOW)e.element.style.display=a?"":"none";else if(e.directivename===BareaHelper.DIR_IF)this.#Q(e,a);else if(e.directivename===BareaHelper.DIR_CLASS_IF){let t=e.directivevalue;t.includes("?")&&(t=t.split("?")[1]),this.#Z(e,a,t)}}#B(e,t){t.handlerpieces||(t.handlerpieces=BareaHelper.parseBareaFunctionCall(t.handlername));let a=[];e===BareaHelper.VERB_SET_UI&&(a=[e,t.element,t.data[t.key]]),e===BareaHelper.VERB_SET_DATA&&(a=[e,t.element,t.data,t.key]),a.push(...t.handlerpieces.params),this.#p[t.handlerpieces.functionName]?this.#p[t.handlerpieces.functionName].apply(this,a):console.warn(`Handler function '${t.handlerpieces.functionName}' not found.`)}#Z(e,t,a){let r=a.split(/[\s,]+/);t?r.forEach((t=>{e.element.classList.contains(t)||e.element.classList.add(t)})):r.forEach((t=>{e.element.classList.contains(t)&&e.element.classList.remove(t)}))}#Q(e,t){t?e.element.parentNode||e.elementnextsibling&&e.parentelement.insertBefore(e.element,e.elementnextsibling):e.element.parentNode&&(e.elementnextsibling=e.element.nextSibling,e.element.remove())}#x(e){e.element&&e.element.value!==e.data[e.key]&&(e.data[e.key]?e.element.value=e.data[e.key]:e.element.value="")}#b(e){e.element&&e.element.value!==e.data[e.key]&&(e.data[e.key]?e.element.value=e.data[e.key]:e.element.value="")}#L(e){e.element&&e.element.checked!==e.data[e.key]&&(e.data[e.key]?e.element.checked=e.data[e.key]:e.element.checked=!1)}#U(e){e.element&&"radio"===e.element.type&&void 0!==e.data[e.key]&&e.element.checked!==(e.element.value===e.data[e.key])&&(e.element.checked=e.element.value===e.data[e.key])}#$(e){if(!e.data[e.key])return;e.orgvalue||(e.orgvalue="");let t=e.data[e.key];t.includes(",")&&(t=t.replaceAll(","," ")),e.element.className=t||e.orgvalue}#j(e){e.data[e.key]&&(e.element.src=e.data[e.key])}#X(e){e.data[e.key]&&(e.element.href=e.data[e.key])}#M(e){e.data[e.key]&&(e.element.value=e.data[e.key])}#F(e){e.data[e.key]&&(e.element.textContent=e.data[e.key])}#W(e){let t=e.interpolatednode,a=e.nodetemplate;e.nodeexpressions.forEach((t=>{let r="";const n=this.#k(t.directivevalue,BareaHelper.DIR_INTERPOLATION,t.renderedvarname);n!==BareaHelper.EXPR_TYPE_INVALID?(n===BareaHelper.EXPR_TYPE_COMPUTED?r=this.#m[t.directivevalue].value:[BareaHelper.EXPR_TYPE_ROOT_PATH,BareaHelper.EXPR_TYPE_OBJREF,BareaHelper.EXPR_TYPE_OBJREF_PATH].includes(n)?r=t.isobjectexpression?JSON.stringify(t.data):t.data[t.key]:n===BareaHelper.INTERPOL_INDEX&&(r=String(e.renderedindex)),r||(r="","boolean"==typeof r&&(r="false")),a=a.replaceAll(t.expression,r)):console.error(`The ${BareaHelper.DIR_INTERPOLATION} directive has an invalid expression (${t.directivevalue}).`)})),t.textContent=a}#J(e,t="root",a,r,n){let i=!1,s=!1,o=[],[l,d]=e.directivevalue.split(" in ").map((e=>e.trim()));if(!l)return void console.error(`No variable name was found in the ${e.directivename} expression`);if(!d)return void console.error(`No path or computed function was found in the ${e.directivename} expression`);let c=this.#k(d,e.directivename);if(c!==BareaHelper.EXPR_TYPE_INVALID){if(!r||"shift"!==r&&"pop"!==r&&"splice"!==r||(i=!0),!r||"sort"!==r&&"reverse"!==r&&"splice"!==r||(s=!0),c===BareaHelper.EXPR_TYPE_COMPUTED&&(s=!0),r&&!BareaHelper.ARRAY_FUNCTIONS.includes(r)&&(s=!0),a&&!r&&(s=!0),c===BareaHelper.EXPR_TYPE_COMPUTED?this.#m[d]?o=this.#m[d].value:console.warn(`Could not find computed function name in the ${e.directivename} directive`):o=a||this.getProxifiedPathData(d),s){let t=0;this.#E.removeTemplateDependencies(e.id),e.parentelement.innerHTML="";const a=document.createDocumentFragment();o.forEach((r=>{let n=this.#ee(e,l,r,t);a.appendChild(n),t++})),a.childElementCount>0&&e.parentelement.appendChild(a)}else if("push"===r&&n?n.forEach((t=>{let a=this.#ee(e,l,t,-1);e.parentelement.appendChild(a)})):"unshift"===r&&n?n.reverse().forEach((t=>{let a=this.#ee(e,l,t,-1);e.parentelement.insertBefore(a,e.parentelement.firstChild)})):"pop"===r?e.parentelement.removeChild(e.parentelement.lastChild):"shift"===r&&e.parentelement.removeChild(e.parentelement.firstChild),e.usesReRenderedInterpolation){let t=0;o.forEach((a=>{this.#E.getObjectDependencies(a,e.id).forEach((e=>{e.directivename===BareaHelper.DIR_INTERPOLATION&&e.isrendered&&(e.renderedindex=t,this.#W(e),t++)}))}))}i&&this.#E.removeDeletedElementDependencies(e.id)}else console.error(`The expression for the directive ${e.directivename} value: ${e.directivevalue} is not valid`)}#ee(e,t,a,r=-1){this.#n++;const n=document.createElement(e.templatetagname);if(n.innerHTML=e.templatemarkup,e.elementclone)for(let t of e.elementclone.attributes)BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(t.name)||n.setAttribute(t.name,t.value);return n.id?n.id=n.id+`-${this.#n}`:n.id=`${e.id}-${t}-${this.#n}`,n.querySelectorAll("*").forEach((e=>{e.id?e.id=e.id+`-${this.#n}`:e.id=`${t}-${this.#n}`;let a=e.getAttribute("for");a&&e.setAttribute("for",a+`-${this.#n}`)})),this.#g(n,{template:e,rendereddata:a,renderedindex:r,renderedvarname:t,renderedobjid:this.#n}),n}#k=function(e,t,a){return BareaHelper.DIR_GROUP_BIND_TO_PATH.includes(t)?e.includes("(")||e.includes(")")?BareaHelper.EXPR_TYPE_INVALID:(e.includes(BareaHelper.ROOT_OBJECT)||a)&&e.includes(".")?e.toLowerCase().startsWith("root.")?BareaHelper.EXPR_TYPE_ROOT_PATH:BareaHelper.EXPR_TYPE_OBJREF_PATH:BareaHelper.EXPR_TYPE_INVALID:[BareaHelper.DIR_CLICK,BareaHelper.DIR_BIND_HANDLER].includes(t)?e.includes("(")&&e.includes(")")?BareaHelper.EXPR_TYPE_HANDLER:BareaHelper.EXPR_TYPE_INVALID:BareaHelper.DIR_GROUP_COMPUTED.includes(t)?e.includes("(")||e.includes(")")?BareaHelper.EXPR_TYPE_INVALID:e.includes("root.")?a&&e.includes(a+".")?BareaHelper.EXPR_TYPE_MIX_EXPR:BareaHelper.EXPR_TYPE_ROOT_EXPR:!e.includes(".")&&this.#m[e]?BareaHelper.EXPR_TYPE_COMPUTED:e.includes(a)?BareaHelper.EXPR_TYPE_OBJREF_EXPR:BareaHelper.EXPR_TYPE_INVALID:t===BareaHelper.DIR_FOREACH?e.includes("root.")?BareaHelper.EXPR_TYPE_ROOT_PATH:e.includes(".")?BareaHelper.EXPR_TYPE_INVALID:BareaHelper.EXPR_TYPE_COMPUTED:t===BareaHelper.DIR_INTERPOLATION?e.includes("(")||e.includes(")")?BareaHelper.EXPR_TYPE_INVALID:e.toLowerCase()===a+"."+BareaHelper.INTERPOL_INDEX?BareaHelper.INTERPOL_INDEX:e.toLowerCase().startsWith("root.")?BareaHelper.EXPR_TYPE_ROOT_PATH:e.includes(".")?BareaHelper.EXPR_TYPE_OBJREF_PATH:this.#l.includes(e)?BareaHelper.EXPR_TYPE_COMPUTED:BareaHelper.EXPR_TYPE_OBJREF:BareaHelper.EXPR_TYPE_INVALID};#z(e){return e.match(/\{\{\s*.*?\s*\}\}/g)||[]}#te(e){return null!==e&&"object"!=typeof e&&"function"!=typeof e}#_(e,t){let a=this,r=this.#f,n=this.#E;return new class{dependentDirectives=new Set;constructor(e,t){this.name=t,this.getter=e,this.dirty=!0,this.dependencyPaths=new Set,this.setDirty=e=>{this.dirty=!0,n.notifyDependentUserInterface(this.dependentDirectives)}}track(e,t){e.addSubscriber(this.name,this.setDirty),this.dependencyPaths.add(t)}addDependentDirective(e){this.dependentDirectives.add(e)}clearDependentDirectives(){this.dependentDirectives.clear()}get value(){return this.dirty&&(r.start(this),this._value=this.getter.call(a),r.stop(),this.dirty=!1),this._value}}(e,t)}#D(){let e;return new class{#ae=null;#re=null;constructor(){if(e)return e;this.#ae=new Map,e=this}start(e){this.#re=e}stop(){this.#re=null}getAllDependencies(){return this.#ae}isDepencencyPath(e,t){if(!e)return!1;if(!t)return!1;if(!this.#ae.has(e))return!1;for(let a of this.#ae.keys()){if(a!==e)continue;let r=this.#ae.get(a);for(let e of r.subscribers.keys())if(e===t)return!0}return!1}track(e,t){if(!e)return;if(e===BareaHelper.ROOT_OBJECT)return;let a="";if(a=t?e+"."+t.toLowerCase():e,this.#re){let e=this.#ne(a);this.#re.track(e,a)}}notify(e,t){if(!e)return;if(e===BareaHelper.ROOT_OBJECT)return;let a="";a=t?e+"."+t.toLowerCase():e,this.#ne(a).notify(a)}#ne(e){let t=this.#ae.get(e);return t||(t=this.#ie(e),this.#ae.set(e,t)),t}#ie(e){let t=new Map;return{subscribers:t,addSubscriber(e,a){t.has(e)||t.set(e,a)},notify(e){t.forEach(((t,a)=>{t(e)}))}}}}}#P(e){let t,a=this.#m,r=this;return new class{#ae=new Map;#se=new WeakMap;#oe=new Map;#le=null;#de=0;#ce=0;#pe=0;#ue=[];constructor(e){if(t)return t;this.#le=e,t=this}#he(e){let t=!1,a=0;return this.#se.has(e)||(t=!0,this.#se.set(e,++this.#de)),a=this.#se.get(e),{id:a,isnew:t}}removeTemplateDependencies(e=-1){let t=[];this.#ae.forEach(((a,r)=>{for(const n of a)n.template&&n.template.id===e&&-1!==e&&t.push(r)}));for(let e=0;e<t.length-1;e++)this.#ae.delete(t[e]);Object.keys(a).forEach((t=>{for(let r of[...a[t].dependentDirectives])r.template&&r.template.id===e&&a[t].dependentDirectives.delete(r)}))}removeDeletedElementDependencies(e=-1){let t=[];this.#ae.forEach(((a,r)=>{for(const n of a)n.template&&n.template.id===e&&-1!==e&&n.element&&!n.element.isConnected&&t.push(r)}));for(let e=0;e<t.length-1;e++)this.#ae.delete(t[e]);Object.keys(a).forEach((t=>{for(let r of[...a[t].dependentDirectives])r.template&&r.template.id===e&&r.element&&!r.element.isConnected&&a[t].dependentDirectives.delete(r)}))}getObjectDependencies(e,t=-1){let a=[];return this.#ae.forEach(((r,n)=>{for(const n of r)n.template&&n.data&&n.template.id===t&&Object.is(n.data,e)&&a.push(n)})),a}getAllDependencies(){return this.#ae}getTemplateDependencies(){return this.#ue}track(e,t){if(this.#ce++,!t.data&&!t.isrendered&&!BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(t.directivename))return void console.error("Tracked UI has no data",t);if(BareaHelper.DIR_GROUP_COMPUTED.includes(t.directivename))return;const a=t.data;let r="";return r="value"===e?this.#he(a).id+":value:"+t.key:"global"===e?"global":e,!!r&&(this.#ae.has(r)||this.#ae.set(r,new Set),this.#ae.get(r).add(t),BareaHelper.DIR_GROUP_MARKUP_GENERATION.includes(t.directivename)&&t.element&&t.parentelement&&this.#ue.push(t),!0)}notify(e,t,a,n,i){this.#pe++;let s={isnew:!1};n&&(null==n||"object"!=typeof n||i||(s=this.#he(n)));let o=this.#he(t);if(o.isnew||s.isnew)r.refresh(),console.warn("UI dependency tracker was notified of an object that was not tracked - barea.refresh() called. (avoid changing the model structure after mount)",t);else{let r=o.id+":value:"+a,s=this.#ae.get(r);s||(s=new Set),r="global";let l=this.#ae.get(r);l||(l=new Set);let d=new Set([...s,...l]);if(0===d.size)return;this.#le(t,a,n,e,d,i)}}notifyDependentUserInterface(e){e&&this.#le(null,"",null,"",e,"")}clear(){this.#ue=[],this.#ae.clear()}}(e)}}export class BareaViewState extends EventTarget{#me=[];#t=null;#ye=null;#Ee=!1;CurrentState=null;CurrentView=null;constructor(e,t,a=!1){super(),this.CurrentState={},this.#t=e,this.#ye=t,this.#fe(),a&&(this.#Ee=a),this.#De(),this.#Pe(),this.#Ie()}get EntityId(){return this.CurrentState?this.CurrentState.entityId:""}setStateAndNavigate(e,t="",a=!1){if(!e)return;e.includes("/:")&&(e=e.split("/:")[0]),t&&(e.includes(`${t}`)||(e.endsWith("/")||(e+="/"),e+=`${t}`));let r="";e.startsWith("/#")&&(r=e=e.replace("/#","")),e.startsWith("#")&&(r=e=e.replace("#",""));const n=new URL(e,window.location.origin);n.hash=r,this.#_e(n,t,"programatic navigation",a)}init(){const e=new URL(window.location.href);let t="";t=e.hash?e.hash:e.pathname;let a="",r=this.#Te(e);r&&r.IsPersistedEntityView&&(a=this.#ge(e));let n={prevPath:"/",currentPath:t,entityId:a,type:"init",stateTime:Date.now(),urlPathName:e.pathname,urlHash:e.hash};localStorage.setItem("bareaState",JSON.stringify(n)),this.#_e(e,a,"init")}onChange(e){this.CurrentState=JSON.parse(localStorage.getItem("bareaState")),this.addEventListener("stateChanged",(()=>e()))}#fe(){let e=0;document.querySelectorAll("template").forEach((t=>{const a=t.content.querySelectorAll("view");a.length<=0||(e+=1,a.forEach((a=>{let r=a.getAttribute("id");if(!r)return void console.error("BareaViewState - A view <view> in a template is missing id");let n=a.getAttribute("path");if(!n)return void console.error("BareaViewState - A view definition in a template is missing path");let i="",s=a.querySelector("title");s&&(i=s.textContent);let o="",l=a.querySelector("description");l&&(o=l.textContent);let d=function(e){let t={};if(!e)return t;for(let a of e.attributes)t[a.name]=a.value;return t}(a.querySelector("data"));d.title=i,d.description=o;let c=this.#me.find((e=>e.Id==r));if(c){let e=c.getViewDescription();e.hasOwnProperty("title")&&!e.title&&(e.title=i),e.hasOwnProperty("description")&&!e.description&&(e.description=o);for(let t in d)e.hasOwnProperty(t)||(e[t]=d[t]);c.setViewDescription(e)}else c=new BareaView(r,n,this.#ye),c.setViewDescription(d),this.#me.push(c);let p=t.content.querySelector("design");if(!p)return;let u=document.createElement("div");u.setAttribute("id",`${c.Id}_${e}`),t.insertAdjacentElement("afterend",u);let h=p.cloneNode(!0);const m=document.createElement("div");m.innerHTML=h.innerHTML;let y={parent:u,markup:m};c.addViewMarkUpInfo(y)})),t.remove())}))}#De(){let e=this;document.addEventListener("click",(t=>{const a=t.target.closest("a");if(!a)return;if(a.hasAttribute("data-bs-toggle")||a.classList.contains("dropdown-toggle")||a.classList.contains("no-navigation"))return;if(!t.target.href)return;const r=new URL(t.target.href);this.#ve(r)&&(t.preventDefault(),e.#_e(r,"","link navigation"))}))}#Pe(){let e=this;window.addEventListener("hashchange",(function(){e.#_e(window.location,"","hash change navigation")}))}#Ie(){if(!this.#Ee)return;let e=this;window.addEventListener("popstate",(function(t){e.#_e(window.location,"","pop state navigation")}))}#ge(e){if(!e)return"";let t="";t=e.hash?e.hash:e.pathname;let a=t.split("/");if(a.length>1){let e=a[a.length-1];if(e){if(!this.#me.some((t=>t.RequestPath.includes(e))))return e}}return""}#Re(){this.#me.forEach((e=>{e.getViewMarkUpInfo().forEach((e=>{e.parent.replaceChildren()}))}))}#_e(e,t="",a="init",r){if(!e)return;let n=this.#be(),i=this.#Te(e);if(i){if(i.IsPersistedEntityView&&!t&&(t=this.#ge(e)),this.#Be(n.currentPath,i.RequestPath,n.entityId,t)&&this.CurrentView&&!r)return;this.CurrentView=i}else this.CurrentView=null;this.#Re(),n.prevPath=n.currentPath,"init"!==a&&(e.hash?(window.location.hash=e.hash,n.currentPath=e.hash):(n.currentPath=e.pathname,this.#Ee?history.pushState(this.CurrentState,a,e):window.location.href=e)),n.urlPathName=e.pathname,n.urlHash=e.hash,n.stateTime=Date.now(),n.type=a,n.entityId=t,this.CurrentState=n,localStorage.setItem("bareaState",JSON.stringify(this.CurrentState)),BareaHelper.getDebugLog(10).active&&console.info(`state engine: ${a}`,this.CurrentState),this.dispatchEvent(new Event("stateChanged"))}#ve(e){try{return new URL(e,window.location.origin).origin===window.location.origin}catch(e){return!1}}#Be(e,t,a,r){if(!e||!t)return!1;if(e.startsWith("/")&&!t.startsWith("/")&&(t="/"+t),t.startsWith("/")&&!e.startsWith("/")&&(e="/"+e),e==t)return!0;if(!a||!r)return!1;if(a==r){if(e.includes(a)){if(e==t+"/"+r)return!0;if(e==t+r)return!0}if(t.includes(r)){if(t==e+"/"+a)return!0;if(t==e+a)return!0}}return!1}#be(){try{return JSON.parse(localStorage.getItem("bareaState"))}catch{}return{prevPath:"",currentPath:"",entityId:"",type:"new",stateTime:Date.now()}}#Te(e){let t=null;return this.#me.forEach((a=>{a.validForUrl(e)&&(t=a)})),t}}export class BareaDataModel{#He="";#Ne=[];#Ce=null;constructor(e){e?this.#He=e:console.error("A new instance of BareaDataModel was created without a dbtablename")}useBareaLocalStorageDb(){this.#Ce={engine:"BareaLocalStorageDb"}}useIntwentyAPI(){this.#Ce={engine:"IntwentyAPI"}}get DbTableName(){return this.#He}get DbColumns(){return this.#Ne}addDbStringColumn(e,t=!1){this.#Ne.push({name:e,datatype:"string",autoincrement:!1,primarykey:t})}addDbIntegerColumn(e,t=!1,a=!1){this.#Ne.push({name:e,datatype:"integer",autoincrement:t,primarykey:a})}getBareaDataModel(){let e={};return e[this.#He]={},e.entityList=[],this.#Ne.forEach((t=>{"string"===t.datatype&&(e[this.#He][t.name]=""),"text"===t.datatype&&(e[this.#He][t.name]=""),"integer"===t.datatype&&(e[this.#He][t.name]=0),"boolean"===t.datatype&&(e[this.#He][t.name]=!1)})),e}async createEntity(e){const t=this.#Oe();return t?t.createEntity(e):(console.error("No database engine was specified, for mockup call: useBareaLocalStorageDb() (BareaDataModel)"),!1)}async updateEntity(e,t){const a=this.#Oe();return a?a.updateEntity(e,t):(console.error("No database engine was specified, for mockup call: useBareaLocalStorageDb() (BareaDataModel)"),!1)}async getEntities(e=""){const t=this.#Oe();return t?t.getEntities(e):(console.error("No database engine was specified, for mockup call: useBareaLocalStorageDb() (BareaDataModel)"),[])}async getEntity(e){const t=this.#Oe();return t?t.getEntity(e):(console.error("No database engine was specified, for mockup call: useBareaLocalStorageDb() (BareaDataModel)"),{})}async deleteEntity(e){const t=this.#Oe();return t?t.deleteEntity(e):(console.error("No database engine was specified, for mockup call: useBareaLocalStorageDb() (BareaDataModel)"),!1)}#Oe(){if(this.#Ce)return"BareaLocalStorageDb"===this.#Ce.engine?this.#Ae():"IntwentyAPI"===this.#Ce.engine?this.#we():null}#Ae(){const e=this;return new class{#ke(){let t=null,a=localStorage.getItem("BareaDataBase");return a&&(t=JSON.parse(a)),t||(t={},t[e.DbTableName+"_db"]=[],localStorage.setItem("BareaDataBase",JSON.stringify(t))),t}#Se(e){let t=0;return e.forEach((e=>{BareaHelper.isValue(e,"id")&&BareaHelper.getValue(e,"id")>t&&(t=BareaHelper.getValue(e,"id"))})),t}createEntity(t){const a=this.#ke(),r=e.DbColumns.find((e=>e.primarykey&&e.autoincrement&&"integer"==e.datatype));if(r)return t[r.name]||(t[r.name]=this.#Se(a[e.DbTableName+"_db"])+1),a[e.DbTableName+"_db"].push(t),localStorage.setItem("BareaDataBase",JSON.stringify(a)),!0;console.error("BareaLocalStorageDb must have an integer autoincremened primary key column")}updateEntity(t,a){const r=this.#ke(),n=e.DbColumns.find((e=>e.primarykey&&e.autoincrement&&"integer"==e.datatype));if(!n)return void console.error("BareaLocalStorageDb must have an integer autoincremened primary key column");let i=r[e.DbTableName+"_db"],s=i.findIndex((e=>BareaHelper.getValue(e,n.name)==a));return-1!==s&&(i[s]=t,localStorage.setItem("BareaDataBase",JSON.stringify(r)),!0)}getEntities(t=""){const a=this.#ke();if(!e.DbColumns.find((e=>e.primarykey&&e.autoincrement&&"integer"==e.datatype)))return void console.error("BareaLocalStorageDb must have an integer autoincremened primary key column");return a[e.DbTableName+"_db"]}getEntity(t){const a=this.#ke(),r=e.DbColumns.find((e=>e.primarykey&&e.autoincrement&&"integer"==e.datatype));if(r){if(t){return a[e.DbTableName+"_db"].find((e=>BareaHelper.getValue(e,r.name)==t))}return{}}console.error("BareaLocalStorageDb must have an integer autoincremened primary key column")}deleteEntity(t){const a=this.#ke(),r=e.DbColumns.find((e=>e.primarykey&&e.autoincrement&&"integer"==e.datatype));if(!r)return void console.error("BareaLocalStorageDb must have an integer autoincremened primary key column");let n=a[e.DbTableName+"_db"],i=n.findIndex((e=>BareaHelper.getValue(e,r.name)==t));return-1!==i&&(n.splice(i,1),localStorage.setItem("BareaDataBase",JSON.stringify(a)),!0)}}}#we(){const e=this;return new class{#ke(){return{newEntityPath:"/Applications/Api/CreateEntity",editEntityPath:"/Applications/Api/EditEntity",deleteEntityPath:"/Applications/Api/DeleteEntity",getEntityPath:"/Applications/Api/GetEntity",getEntitiesPath:"/Applications/Api/GetEntities"}}async createEntity(t){const a=this.#ke(),r={model:{dbTableName:e.DbTableName,dbColumns:e.DbColumns},data:t,entityId:"",sqlStatement:""};try{const e=await fetch(a.newEntityPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`HTTP Error: ${e.status} - ${e.statusText}`);return!0}catch(e){console.error("Error:",e)}return!1}async updateEntity(t,a){const r=this.#ke(),n={model:{dbTableName:e.DbTableName,dbColumns:e.DbColumns},data:t,entityId:a,sqlStatement:""};try{const e=await fetch(r.editEntityPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error(`HTTP Error: ${e.status} - ${e.statusText}`);return!0}catch(e){console.error("Error:",e)}return!1}async getEntities(t=""){const a=this.#ke(),r={model:{dbTableName:e.DbTableName,dbColumns:e.DbColumns},data:{},entityId:"",sqlStatement:t};try{const e=await fetch(a.getEntitiesPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`HTTP Error: ${e.status} - ${e.statusText}`);return(await e.json()).entities}catch(e){console.error("Error:",e)}return[]}async getEntity(t){const a=this.#ke(),r={model:{dbTableName:e.DbTableName,dbColumns:e.DbColumns},data:{},entityId:t,sqlStatement:""};try{const e=await fetch(a.getEntityPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`HTTP Error: ${e.status} - ${e.statusText}`);return(await e.json()).entity}catch(e){console.error("Error:",e)}return{}}async deleteEntity(t){const a=this.#ke(),r={model:{dbTableName:e.DbTableName,dbColumns:e.DbColumns},data:{},entityId:t,sqlStatement:""};try{const e=await fetch(a.deleteEntityPath,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok)throw new Error(`HTTP Error: ${e.status} - ${e.statusText}`);return!0}catch(e){console.error("Error:",e)}return!1}}}}export class BareaView{#xe="";#Le="";#Ue={};#ye=null;#$e=[];#Xe=!1;constructor(e,t,a=null,r=null){this.#xe=e,this.#Le=t,this.#Le.includes("/:")&&(this.#Xe=!0,this.#Le=this.#Le.split("/:")[0]),this.#ye=a||new BareaDataModel(r)}get Id(){return this.#xe}get IsPersistedEntityView(){return this.#Xe}get RequestPath(){return this.#Le}getViewMarkUpInfo(){return this.#$e}addViewMarkUpInfo(e){this.#$e.push(e)}getDataModel(){return this.#ye}setViewDescription(e){this.#Ue=e}getViewDescription(){return this.#Ue}addDbStringColumn(e,t=!1){this.#ye.addDbStringColumn(e,t)}addDbIntegerColumn(e,t=!1,a=!1){this.#ye.addDbIntegerColumn(e,t,a)}validForUrl(e){if(!e)return!1;if(e.hash){let t=e.hash;if(t.length<2)return!1;if(t.includes(this.#Le))return!0;if(t="/"+t,t.includes(this.#Le))return!0}return!!e.pathname.includes(this.#Le)}render(){this.#$e.forEach((e=>{e.parent.replaceChildren(e.markup.cloneNode(!0))}))}}export class BareaHelper{static DIR_BIND="ba-bind";static DIR_BIND_BLUR="ba-bind-blur";static DIR_BIND_HANDLER="ba-bind-handler";static DIR_FOREACH="ba-foreach";static DIR_CLICK="ba-click";static DIR_CLASS="ba-class";static DIR_CLASS_IF="ba-class-if";static DIR_HIDE="ba-hide";static DIR_SHOW="ba-show";static DIR_IMAGE_SRC="ba-src";static DIR_IF="ba-if";static DIR_HREF="ba-href";static DIR_INTERPOLATION="interpolation";static DIR_OPTION_ID="ba-option-id";static DIR_OPTION_TEXT="ba-option-text";static DIR_GROUP_BIND_TO_PATH=[BareaHelper.DIR_BIND,BareaHelper.DIR_BIND_BLUR,BareaHelper.DIR_CLASS,BareaHelper.DIR_HREF,BareaHelper.DIR_IMAGE_SRC,BareaHelper.DIR_OPTION_ID,BareaHelper.DIR_OPTION_TEXT];static DIR_GROUP_UI_DUPLEX=[BareaHelper.DIR_BIND,BareaHelper.DIR_BIND_BLUR];static DIR_GROUP_TRACK_AND_FORGET=[BareaHelper.DIR_CLICK];static DIR_GROUP_COMPUTED=[BareaHelper.DIR_CLASS_IF,BareaHelper.DIR_HIDE,BareaHelper.DIR_SHOW,BareaHelper.DIR_IF];static DIR_GROUP_MARKUP_GENERATION=[BareaHelper.DIR_FOREACH];static UI_INPUT_TEXT=1;static UI_INPUT_CHECKBOX=2;static UI_INPUT_RADIO=3;static UI_INPUT_SELECT=4;static UI_INPUT_CUSTOM=10;static VERB_SET_DATA="SET_DATA";static VERB_SET_UI="SET_UI";static META_PATH="ba-path";static META_DYN_FUNC_PREFIX="dynFunc_";static META_DYN_TEMPLATE_FUNC_PREFIX="dynTemplFunc_";static INTERPOL_INDEX="index";static EXPR_TYPE_ROOT_PATH="root-path";static EXPR_TYPE_HANDLER="static-handler";static EXPR_TYPE_COMPUTED="computed";static EXPR_TYPE_OBJREF="child-obj";static EXPR_TYPE_OBJREF_PATH="child-obj-path";static EXPR_TYPE_OBJREF_EXPR="child-obj-expression";static EXPR_TYPE_ROOT_EXPR="root-expr";static EXPR_TYPE_MIX_EXPR="root-and-child-expression";static EXPR_TYPE_INVALID="invalid-expression";static ROOT_OBJECT="root";static ARRAY_FUNCTIONS=["push","pop","splice","shift","unshift","reverse","sort"];static DebugLogs=[{id:1,name:"BareaApp - Proxy call back: ",active:!1},{id:2,name:"BareaApp - Update dom on proxy change: ",active:!1},{id:3,name:"BareaApp - Update proxy on user input: ",active:!1},{id:4,name:"BareaApp - Print tracked UI dependencies: ",active:!1},{id:5,name:"BareaApp - Print tracked computed dependencies: ",active:!1},{id:10,name:"BareaViewState - On state changed: ",active:!1}];static deepTraverseObjectToArray=function(e,t="root"){let a=[];if(null!==e&&"object"==typeof e){for(let r in e)if(e.hasOwnProperty(r)){const n=t?`${t}.${r}`:r;Array.isArray(e[r])?(a.push({path:n,type:"array",value:e[r]}),e[r].forEach(((e,t)=>{a=a.concat(BareaHelper.deepTraverseObjectToArray(e,`${n}[${t}]`))}))):"object"==typeof e[r]&&null!==e[r]?(a.push({path:n,type:"object",value:e[r]}),a=a.concat(BareaHelper.deepTraverseObjectToArray(e[r],n))):a.push({path:n,type:"primitive",value:e[r]})}}else a.push({path:t,type:"primitive",value:null});return a};static getObjectDictionary=function(e,t=""){let a={};for(const r in e)if(e.hasOwnProperty(r)){const n=t?`${t}.${r}`:r;"object"==typeof e[r]&&null!==e[r]?Array.isArray(e[r])?(a[n]=e[r],e[r].forEach(((e,t)=>{a[`${n}[${t}]`]=e,Object.assign(a,this.getObjectDictionary(e,`${n}[${t}]`))}))):(a[n]=e[r],Object.assign(a,this.getObjectDictionary(e[r],n))):a[n]=e[r]}return a};static getLastBareaKeyName=function(e){if(!e)return"root";let t=e.split(".");if(t.length<2)return"root";let a="";return t.forEach((e=>{a=e})),a};static isValue=function(e,t){if(!e||"object"!=typeof e||!t)return!1;const a=t.toLowerCase();return Object.keys(e).some((t=>t.toLowerCase()===a&&null!=e[t]))};static getValue=function(e,t){if(!e||"object"!=typeof e||!t)return;const a=t.toLowerCase();for(const t in e)if(t.toLowerCase()===a)return e[t]};static getLastBareaObjectPath=function(e){if(!e)return void console.error("callk to BareaHelper.getLastBareaObjectPath() without a path");let t=null,a=e.split(".");for(let e=0;e<a.length-1;e++)t?t+="."+a[e]:t=a[e];return null==t&&(t=e),t};static parseBareaFunctionCall=function(e){function t(e){return/^["'].*["']$/.test(e)?e.slice(1,-1):"true"===e||"false"!==e&&("null"===e?null:isNaN(e)?/^\[.*\]$/.test(e)?e.slice(1,-1).split(",").map((e=>t(e.trim()))):e:e.includes(".")?parseFloat(e):parseInt(e,10))}const a=e.match(/^(\w+)\((.*)\)$/);if(!a)return null;const[r,n,i]=a;return{functionName:n,params:i.trim()?[...i.matchAll(/'[^']*'|"[^"]*"|[^,]+/g)].map((e=>t(e[0].trim()))):[]}};static hasAnyChar=function(e,t){return t.some((t=>e.includes(t)))};static enableDebugLog=function(e){const t=BareaHelper.DebugLogs.findIndex((t=>t.id===e));-1!==t&&(BareaHelper.DebugLogs[t].active=!0)};static getDebugLog=function(e){const t=BareaHelper.DebugLogs.find((t=>t.id===e));return t||{id:-1,name:"",active:!1}};static printDebugLogs=function(){console.log("barea: available logs:"),BareaHelper.DebugLogs.forEach((e=>console.log(e)))}}
//# sourceMappingURL=/sm/c347df30c6d0684dcb05af2f20095f9a5109556179060f0529a8c95c106bd0c1.map